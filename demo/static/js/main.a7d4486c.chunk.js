(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{272:function(e,t,a){e.exports=a.p+"static/media/demo.6318aa84.jpg"},273:function(e,t,a){e.exports=a.p+"static/media/semantic-segmentation.json.a51c4372.resp"},274:function(e,t,a){e.exports=a.p+"static/media/object-detection.json.b776f784.resp"},281:function(e,t,a){e.exports=a.p+"static/media/labeling-interface-annotated.7229b60a.png"},282:function(e,t,a){e.exports=a.p+"static/media/labels.dc5b1f59.png"},283:function(e,t,a){e.exports=a.p+"static/media/bbox-labeling.9e5e9969.gif"},284:function(e,t,a){e.exports=a.p+"static/media/polygon-labeling.27bf4f58.gif"},285:function(e,t,a){e.exports=a.p+"static/media/add-new-point.0a9ce62a.png"},286:function(e,t,a){e.exports=a.p+"static/media/show-and-hide-layer.b68524e5.gif"},287:function(e,t,a){e.exports=a.p+"static/media/change-layer.57058590.gif"},288:function(e,t,a){e.exports=a.p+"static/media/auto-tracing.b56cc456.gif"},289:function(e,t){e.exports="data:image/png;base64,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"},290:function(e,t,a){e.exports=a.p+"static/media/toolbar.23a4dcfc.png"},291:function(e,t,a){e.exports=a.p+"static/media/ml-object-description.a23f25f8.gif"},292:function(e,t,a){e.exports=a.p+"static/media/ml-object-detection.8dadc923.gif"},293:function(e,t,a){e.exports=a.p+"static/media/ml-semantic-segmentation.8f4eba9f.gif"},294:function(e,t,a){e.exports=a.p+"static/media/project-page.c1623ee4.png"},295:function(e,t,a){e.exports=a.p+"static/media/project-images.f040ae73.png"},296:function(e,t,a){e.exports=a.p+"static/media/project-data.a05cc073.png"},297:function(e,t,a){e.exports=a.p+"static/media/project-reference.81a878d9.png"},298:function(e,t,a){e.exports=a.p+"static/media/project-reference-interface.2e520ab6.png"},299:function(e,t,a){e.exports=a.p+"static/media/project-ml-assist.6f2dc06b.png"},312:function(e,t,a){e.exports=a(536)},317:function(e,t,a){},465:function(e,t,a){},472:function(e,t,a){},536:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(45),i=a.n(l),o=(a(317),a(44)),c=a(14),s=a(15),u=a(18),p=a(13),d=a(19),h=(a(559),a(564)),m=a(544),f=a(557),g=a(543),b=a(179),v=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props.active;return r.a.createElement("div",{style:{background:"#f7f7f7",minHeight:"100vh"}},r.a.createElement(f.a,{inverted:!0},r.a.createElement(g.a,null,r.a.createElement(f.a.Item,{header:!0},"Image Labeling"),r.a.createElement(m.a,{to:"/"},r.a.createElement(f.a.Item,{active:"label"===e},r.a.createElement(b.a,{name:"tag",style:{marginRight:"5px"}}),"Label")),r.a.createElement(m.a,{to:"/admin/"},r.a.createElement(f.a.Item,{active:"admin"===e},r.a.createElement(b.a,{name:"pencil",style:{marginRight:"5px"}}),"Admin")),r.a.createElement(m.a,{to:"/help/"},r.a.createElement(f.a.Item,{active:"help"===e},r.a.createElement(b.a,{name:"help circle",style:{marginRight:"5px"}}),"Help")))),r.a.createElement(g.a,null,this.props.children))}}]),t}(n.Component),y=a(10),E=a.n(y),x=a(28),j=a(8),k=a(545),O=a(561),w=a(555),C=a(558),S=a(562),I=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={error:null,isLoaded:!1,projects:[]},a.onNewProject=a.onNewProject.bind(Object(j.a)(Object(j.a)(a))),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/projects/");case 3:return e.next=5,e.sent.json();case 5:t=e.sent,this.setState({isLoaded:!0,projects:t}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.setState({isLoaded:!0,error:e.t0});case 12:case"end":return e.stop()}},e,this,[[0,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"onNewProject",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t,a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/projects",{method:"POST"});case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,this.setState({projects:this.state.projects.concat([a])});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.error,a=e.isLoaded,n=e.projects,l=this.props,i=l.linkPrefix,o=l.newButton,c=l.title;if(t)return r.a.createElement("div",null,"Error: ",t.message);if(!a)return r.a.createElement(k.a,{active:!0,inline:"centered"});var s=o?r.a.createElement(C.a,{style:{padding:"1.5em"},onClick:this.onNewProject},r.a.createElement("span",{style:{fontSize:"4em"}},"+"),r.a.createElement("div",null,"Make a new project")):null;return r.a.createElement("div",null,r.a.createElement(S.a,{as:"h1"},c),r.a.createElement(O.a,{stackable:!0,columns:2},n.map(function(e){var t=e.id,a=e.name,n=e.form,l=e.imagesCount,o=e.labelsCount,c="".concat(l," images, ").concat(o," labeled"),s="Tags: ".concat(n.formParts.map(function(e){return e.name}).join(", "));return r.a.createElement(O.a.Column,{key:t},r.a.createElement(m.a,{to:"".concat(i).concat(t)},r.a.createElement(w.a,{fluid:!0,link:!0,header:a,meta:c,description:s})))}),r.a.createElement(O.a.Column,null,s)))}}]),t}(n.Component),L=(n.Component,a(36)),A=a(82),P=a(32),T=a.n(P),D=(a(437),a(12)),R=a(231),F=a(234),N=a(230),H=a(260),M=a.n(H),z=(a(442),a(448),a(55)),U=a(232),B=a(233),G=a(229),_=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={dragging:!1,draggedPoint:null},a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"calculateGuides",value:function(){return[]}},{key:"onPointClick",value:function(e){}},{key:"onPointMoved",value:function(e,t){}},{key:"makeExtraElements",value:function(){return null}},{key:"leafletComponent",value:function(){return U.a}},{key:"getRenderPoints",value:function(e){return e}},{key:"makeGuides",value:function(){var e=this.calculateGuides(),t=this.props.options.color;return e.map(function(e,a){return r.a.createElement(B.a,{key:a,positions:e,color:t,opacity:.7,dashArray:"5"})})}},{key:"hasFill",value:function(){return!0}},{key:"render",value:function(){var e=this,t=this.props,a=t.figure,l=t.options,i=t.skipNextClick,o=a.id,c=a.points,s=l.editing,u=l.finished,p=l.sketch,d=l.color,h=l.vertexColor,m=l.interactive,f=l.onSelect,g=this.state.draggedPoint,b=this.getRenderPoints(c),v=s?"10":"1",y=s&&p?d:h||d,E=s&&p?"rgba(0,0,0,0)":d,x=s&&p?2:3,j=["vertex"];s&&j.push("editing"),u&&j.push("finished");var k=h||d,O=b.map(function(t,a){return r.a.createElement(G.a,{className:j.concat(a?[]:["first"]).join(" "),key:o+"-"+a,center:t,fillOpacity:0,opacity:0,radius:11,onClick:function(){return e.onPointClick(a)},draggable:s,onDrag:function(t){e.setState({draggedPoint:{point:t.target.getLatLng(),index:a}})},onDragstart:function(t){return e.setState({dragging:!0})},onDragend:function(t){e.onPointMoved(t.target.getLatLng(),a),e.setState({dragging:!1,draggedPoint:null})}},r.a.createElement(G.a,{color:k,fill:!0,fillColor:k,fillRule:"nonzero",fillOpacity:1,radius:4,center:g&&g.index===a?g.point:t}))}),w=this.makeGuides(),C=this.leafletComponent();return r.a.createElement(n.Fragment,{key:o},r.a.createElement(C,{positions:b,color:y,weight:x,fill:this.hasFill(),fillColor:E,opacity:p?"0.7":"1.0",dashArray:v,interactive:"trace"!==o,onClick:function(){m&&(f(),i())}}),w,this.makeExtraElements(),!u||s?O:null)}}]),t}(n.Component),J=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).onPointClick=a.onPointClick.bind(Object(j.a)(Object(j.a)(a))),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"leafletComponent",value:function(){return this.props.options.finished?U.a:B.a}},{key:"calculateGuides",value:function(){var e=this.props,t=e.figure,a=e.options,n=t.points,r=a.newPoint,l=a.finished,i=this.state.draggedPoint,o=[];if(i){var c=i.point,s=i.index,u=n.length;o.push([c,n[(s+1)%u]],[c,n[(s-1+u)%u]])}var p=!l&&n.length>0?[[n[n.length-1],r]]:[];return o.concat(p)}},{key:"makeExtraElements",value:function(){var e=this.props,t=e.figure,a=e.options,n=e.skipNextClick,l=t.id,i=t.points,o=a.editing,c=a.finished,s=a.calcDistance,u=a.onChange,p=this.state.dragging;return c&&o&&!p?i.map(function(e,t){return[e,i[(t+1)%i.length],t]}).filter(function(e){var t=Object(z.a)(e,2),a=t[0],n=t[1];return s(a,n)>40}).map(function(e){var a=Object(z.a)(e,3),i=a[0],o=a[1],c=a[2];return r.a.createElement(G.a,{key:l+"-"+c+"-mid",className:"midpoint",center:X(i,o),radius:8,opacity:0,fillOpacity:0,onMousedown:function(e){u("add",{point:X(i,o),pos:c+1,figure:t}),n()}},r.a.createElement(G.a,{radius:3,color:"white",fill:!0,fillOpacity:.5,opacity:.5,center:X(i,o)}))}):[]}},{key:"onPointMoved",value:function(e,t){var a=this.props,n=a.figure;(0,a.options.onChange)("move",{point:e,pos:t,figure:n})}},{key:"onPointClick",value:function(e){var t=this.props,a=t.figure,n=t.options,r=t.skipNextClick,l=a.points,i=n.finished,o=n.editing,c=n.onChange;return i||0!==e?i&&o?(l.length>3&&c("remove",{pos:e,figure:a}),r(),!1):void 0:(l.length>=3&&c("end",{}),r(),!1)}}]),t}(_),W=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"calculateGuides",value:function(){var e=this.props,t=e.figure,a=e.options,n=t.points,r=a.newPoint,l=a.finished,i=this.state.draggedPoint;if(i){var o=this.getRenderPoints(n),c=i.point,s=o[(i.index+2)%o.length],u={lat:s.lat,lng:c.lng},p={lat:c.lat,lng:s.lng};return[[c,u],[u,s],[c,p],[p,s]]}if(!l&&n.length>0){var d=this.getRenderPoints([n[0],r]);return[[d[0],d[1]],[d[1],d[2]],[d[2],d[3]],[d[3],d[0]]]}return[]}},{key:"getRenderPoints",value:function(e){var t=Object(z.a)(e,2),a=t[0],n=t[1];return a?n?[{lat:a.lat,lng:a.lng},{lat:a.lat,lng:n.lng},{lat:n.lat,lng:n.lng},{lat:n.lat,lng:a.lng}]:[a]:[]}},{key:"onPointMoved",value:function(e,t){var a=this.props,n=a.figure,r=a.options.onChange;if(0===t||2===t)r("move",{point:e,pos:t/2,figure:n});else{var l=Object(z.a)(n.points,2),i=l[0],o=l[1];r("replace",{points:1===t?[{lat:e.lat,lng:i.lng},{lat:o.lat,lng:e.lng}]:[{lat:i.lat,lng:e.lng},{lat:e.lat,lng:o.lng}],figure:n})}}}]),t}(_);function X(e,t){return{lat:(e.lat+t.lat)/2,lng:(e.lng+t.lng)/2}}var Z={red:"#B03060",orange:"#FE9A76",yellow:"#FFD700",olive:"#32CD32",green:"#016936",teal:"#008080",blue:"#0E6EB8",violet:"#EE82EE",purple:"#B413EC",pink:"#FF1493",brown:"#A52A2A",gray:"#A0A0A0",black:"#000000"};function V(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}var Y=["red","blue","green","violet","orange","brown","yellow","olive","teal","purple","pink","black"],Q=a(143),q=7;var K=function(e){var t=function(t){function a(){return Object(c.a)(this,a),Object(u.a)(this,Object(p.a)(a).apply(this,arguments))}return Object(d.a)(a,t),Object(s.a)(a,[{key:"calcBounds",value:function(){var e=D.CRS.Simple,t=this.props,a=t.height,n=t.width;if(!a||!n)return null;var r=e.unproject({x:0,y:a},q-1),l=e.unproject({x:n,y:0},q-1);return new D.LatLngBounds(r,l)}},{key:"render",value:function(){var t=this.props,a=t.forwardedRef,n=Object(Q.a)(t,["forwardedRef"]),l=this.calcBounds();return l?r.a.createElement(e,Object.assign({bounds:l,ref:a},n)):null}}]),a}(n.PureComponent);return Object(n.forwardRef)(function(e,a){return r.a.createElement(t,Object.assign({},e,{forwardedRef:a}))})}(function(e){function t(e,a){var n;return Object(c.a)(this,t),(n=Object(u.a)(this,Object(p.a)(t).call(this,e,a))).state={zoom:-1,selectedFigureId:null,cursorPos:{lat:0,lng:0}},n.prevSelectedFigure=null,n.skipNextClickEvent=!1,n.mapRef=r.a.createRef(),n.handleChange=n.handleChange.bind(Object(j.a)(Object(j.a)(n))),n.handleClick=n.handleClick.bind(Object(j.a)(Object(j.a)(n))),n}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this.props.onSelectionChange,a=this.state.selectedFigureId;this.prevSelectedFigureId!==a&&t&&(this.prevSelectedFigureId=a,t(a))}},{key:"getSelectedFigure",value:function(){var e=this.state.selectedFigureId;return this.props.figures.find(function(t){return t.id===e})}},{key:"handleChange",value:function(e,t){var a=t.point,n=t.pos,r=t.figure,l=t.points,i=this.props,o=i.onChange,c=i.unfinishedFigure,s=!!c;switch(e){case"add":if(s){var u=c.points;u=T()(u,{$push:[a]}),o("unfinished",T()(c,{points:{$set:u}}))}else o("replace",T()(r,{points:{$splice:[[n,0,a]]}}));break;case"end":o("new",c);break;case"move":o("replace",T()(r,{points:{$splice:[[n,1,a]]}}));break;case"replace":o("replace",T()(r,{points:{$set:l}}));break;case"remove":o("replace",T()(r,{points:{$splice:[[n,1]]}}));break;default:throw new Error("unknown event type "+e)}}},{key:"handleClick",value:function(e){var t,a=!!this.props.unfinishedFigure;this.skipNextClickEvent?this.skipNextClickEvent=!1:a?this.handleChange("add",{point:(t=e.latlng,{lat:t.lat,lng:t.lng})}):a||this.setState({selectedFigureId:null})}},{key:"renderFigure",value:function(e,t){var a=this,n="bbox"===e.type?W:J;return r.a.createElement(n,{key:e.id,figure:e,options:t,skipNextClick:function(){return a.skipNextClickEvent=!0}})}},{key:"render",value:function(){var e=this,t=this.props,a=t.url,n=t.bounds,l=t.height,i=t.width,o=t.figures,c=t.unfinishedFigure,s=t.onChange,u=t.onReassignment,p=t.style,d=this.state,h=d.zoom,m=d.selectedFigureId,f=d.cursorPos,g=!!c,v=function(t,a){var n=e.mapRef.current.leafletElement;return n.latLngToLayerPoint(t).distanceTo(n.latLngToLayerPoint(a))},y=g?this.renderFigure(c,{finished:!1,editing:!1,interactive:!1,color:Z[c.color],onChange:this.handleChange,calcDistance:v,newPoint:f}):null,E=function(e){return e.tracingOptions&&e.tracingOptions.enabled?function(e,t){var a=!1;"#"===e[0]&&(e=e.slice(1),a=!0);var n=parseInt(e,16),r=(n>>16)+t;r>255?r=255:r<0&&(r=0);var l=(n>>8&255)+t;l>255?l=255:l<0&&(l=0);var i=(255&n)+t;return i>255?i=255:i<0&&(i=0),(a?"#":"")+(i|l<<8|r<<16).toString(16)}(Z[e.color],80):Z[e.color]},x=o.map(function(t,a){return e.renderFigure(t,{editing:m===t.id&&!g,finished:!0,interactive:!g,sketch:t.tracingOptions&&t.tracingOptions.enabled,color:E(t),vertexColor:Z[t.color],onSelect:function(){return e.setState({selectedFigureId:t.id})},onChange:e.handleChange,calcDistance:v})}),j=r.a.createElement(A.a,{keyName:"backspace,del,c,f,-,=,left,right,up,down",onKeyDown:function(t){var a=document.activeElement?document.activeElement.tagName.toLowerCase():null;if(["input","textarea"].includes(a))return!1;if(g){if("f"===t){var n=c.type,r=c.points;"polygon"===n&&r.length>=3&&e.handleChange("end",{})}}else"c"===t?m&&e.getSelectedFigure()&&u(e.getSelectedFigure().type):"backspace"!==t&&"del"!==t||m&&e.getSelectedFigure()&&s("delete",e.getSelectedFigure());var l=e.mapRef.current.leafletElement;"left"===t&&l.panBy([80,0]),"right"===t&&l.panBy([-80,0]),"up"===t&&l.panBy([0,80]),"down"===t&&l.panBy([0,-80]),"="===t&&l.setZoom(l.getZoom()+1),"-"===t&&l.setZoom(l.getZoom()-1)}}),k=null,O=this.getSelectedFigure();if(O&&"polygon"===O.type){var w={id:"trace",type:"line",points:O.tracingOptions&&O.tracingOptions.trace||[]},C={editing:!1,finished:!0,color:Z[O.color]};k=r.a.createElement(J,{figure:w,options:C})}return r.a.createElement("div",{style:Object(L.a)({cursor:g?"crosshair":"grab",height:"100%"},p)},r.a.createElement(R.a,{crs:D.CRS.Simple,zoom:h,minZoom:-50,maxZoom:q,center:[l/2,i/2],zoomAnimation:!1,zoomSnap:.1,zoomControl:!1,keyboard:!1,attributionControl:!1,onClick:this.handleClick,onZoom:function(t){return e.setState({zoom:t.target.getZoom()})},onMousemove:function(t){return e.setState({cursorPos:t.latlng})},ref:this.mapRef},r.a.createElement(F.a,{position:"bottomright"}),r.a.createElement(M.a,{className:"leaflet-bar",position:"bottomright"},r.a.createElement("a",{role:"button",title:"Zoom reset",href:"#",onClick:function(){var t=e.mapRef.current.leafletElement;t.setView(t.options.center,t.options.zoom)}},r.a.createElement(b.a,{name:"redo",fitted:!0,style:{fontSize:"1.2em"}}))),r.a.createElement(N.a,{url:a,bounds:n}),y,k,x,j))}}]),t}(n.Component)),$=a(553),ee=a(560),te={height:"100vh",overflowY:"auto",overflowX:"hidden",borderRight:"1px solid #ccc"},ae={fontSize:"0.8em",float:"right"};function ne(e){var t=e.labels,a=e.onClose,n=t.map(function(e,t){return r.a.createElement($.a.Row,{key:e},r.a.createElement($.a.Cell,null,e),r.a.createElement($.a.Cell,null,t))});return r.a.createElement("div",{style:te},r.a.createElement(S.a,{as:"h2",attached:"top"},"Hotkeys",r.a.createElement(b.a,{link:!0,name:"close",style:ae,onClick:a})),r.a.createElement(ee.a,{attached:!0},r.a.createElement(S.a,{as:"h3"}," Labels "),r.a.createElement($.a,{celled:!0},r.a.createElement($.a.Header,null,r.a.createElement($.a.Row,null,r.a.createElement($.a.HeaderCell,null,"Action"),r.a.createElement($.a.HeaderCell,null,"Key"))),r.a.createElement($.a.Body,null,n)),r.a.createElement(S.a,{as:"h3"}," General "),r.a.createElement($.a,{celled:!0},r.a.createElement($.a.Header,null,r.a.createElement($.a.Row,null,r.a.createElement($.a.HeaderCell,null,"Action"),r.a.createElement($.a.HeaderCell,null,"Key"))),r.a.createElement($.a.Body,null,r.a.createElement($.a.Row,null,r.a.createElement($.a.Cell,null,"Complete shape"),r.a.createElement($.a.Cell,null,"f")),r.a.createElement($.a.Row,null,r.a.createElement($.a.Cell,null,"Change label"),r.a.createElement($.a.Cell,null,"c")),r.a.createElement($.a.Row,null,r.a.createElement($.a.Cell,null,"Delete figure"),r.a.createElement($.a.Cell,null,"Delete")),r.a.createElement($.a.Row,null,r.a.createElement($.a.Cell,null,"Cancel selection"),r.a.createElement($.a.Cell,null,"Escape")),r.a.createElement($.a.Row,null,r.a.createElement($.a.Cell,null,"Undo the edit"),r.a.createElement($.a.Cell,null,"Ctrl+Z")))),r.a.createElement(S.a,{as:"h3"}," Navigation "),r.a.createElement($.a,{celled:!0},r.a.createElement($.a.Header,null,r.a.createElement($.a.Row,null,r.a.createElement($.a.HeaderCell,null,"Action"),r.a.createElement($.a.HeaderCell,null,"Key"))),r.a.createElement($.a.Body,null,r.a.createElement($.a.Row,null,r.a.createElement($.a.Cell,null,"Zoom In"),r.a.createElement($.a.Cell,null,"+/=")),r.a.createElement($.a.Row,null,r.a.createElement($.a.Cell,null,"Zoom Out"),r.a.createElement($.a.Cell,null,"-")),r.a.createElement($.a.Row,null,r.a.createElement($.a.Cell,null,"Move the Image"),r.a.createElement($.a.Cell,null,"\u2190\u2192\u2191\u2193"))))))}var re=a(552),le=a(546),ie=a(551),oe=a(547),ce=a(548),se=a(253),ue={fontSize:"0.8em",float:"right"},pe=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.title,a=e.onSelect,n=e.labels,l=e.selected,i=e.toggles,o=e.onToggle,c=e.filter,s=e.style,u=e.openHotkeys,p=e.onBack,d=e.onSkip,h=e.onSubmit,m=e.labelData,f=e.onFormChange,g=e.models,v=e.makePrediction,y=u?r.a.createElement(b.a,{link:!0,name:"keyboard",style:ue,onClick:u}):null,j=function(e){var t=e.type,n=e.id;return"bbox"===t||"polygon"===t?function(){return a(n)}:null};return r.a.createElement("div",{style:Object(L.a)({display:"flex",flexDirection:"column",padding:"1em 0.5em",borderRight:"1px solid #ccc",height:"100%"},s)},r.a.createElement(S.a,{size:"large",style:{flex:"0 0 auto"}},t,y),r.a.createElement(re.a,{divided:!0,selection:!0,style:{flex:1,overflowY:"auto"}},n.map(function(e,t){return function(e){var t=e.shortcut,a=e.label,n=e.onSelect,l=e.onToggle,i=e.color,o=e.selected,c=void 0!==o&&o,s=e.disabled,u=void 0!==s&&s,p=e.isToggled,d=void 0!==p&&p,h=e.labelData,m=e.onFormChange,f=e.models,g=e.makePrediction,v=[];l&&he[a.type]&&v.push(r.a.createElement(C.a,{key:"visibility-icon",icon:d?"eye":"eye slash",style:{padding:5},onClick:function(e){l(a),e.stopPropagation()}}));var y=de[a.type],j=y?r.a.createElement(b.a,{key:"type-icon",name:y,style:{opacity:.5,display:"inline-block",marginLeft:5}}):null;return r.a.createElement(re.a.Item,{onClick:n,disabled:u,active:c,key:a.id,style:{fontSize:"1.3em"}},r.a.createElement(A.a,{keyName:t,onKeyDown:function(){return!u&&n&&n()}},r.a.createElement(se.a,{color:i,horizontal:!0},t),a.name,j,r.a.createElement("span",{style:{float:"right"}},v),function(e){var t={fontSize:"12px"};if("text"===e.type){var a=(f||[]).filter(function(e){var t=e.type;return"object_classification"===t}),n=a.map(function(e){var t=e.id,a=e.name;return{value:t,text:a}}),l=a.length>0?r.a.createElement("div",null,"Fill in using a model prediction:",r.a.createElement(le.a,{options:n,placeholder:"Select a model",onChange:function(){var t=Object(x.a)(E.a.mark(function t(a,n){var r,l,i;return E.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.value,l=f.find(function(e){var t=e.id;return t===r}),t.next=4,g(l);case 4:i=t.sent.join(", "),m(e.id,[i]);case 6:case"end":return t.stop()}},t,this)}));return function(e,a){return t.apply(this,arguments)}}()})):null;return r.a.createElement(re.a,{style:t},r.a.createElement(re.a.Item,null,r.a.createElement(ie.a,null,r.a.createElement(ie.a.Input,{label:e.prompt,style:{width:"100%"},value:h[0]||"",onChange:function(t,a){var n=a.value;return m(e.id,[n])}}),l)))}if("select"===e.type){var i=e.options,o=function(t){return function(a,n){var r=n.checked;return m(e.id,r?h.concat([t]):h.filter(function(e){return e!==t}))}},c=i.map(function(e){return r.a.createElement(re.a.Item,{key:e},r.a.createElement(oe.a,{label:e,checked:-1!==h.indexOf(e),onChange:o(e)}))});return r.a.createElement(re.a,{style:t},c)}if("select-one"===e.type){var s=e.options,u=s.map(function(t){return r.a.createElement(re.a.Item,{key:t},r.a.createElement(ce.a,{label:t,checked:-1!==h.indexOf(t),onChange:function(a,n){n.checked;return m(e.id,[t])}}))});return r.a.createElement(re.a,{style:t},u)}return null}(a)))}({shortcut:"1234567890qwe"[t],label:e,color:Y[t],onSelect:j(e),selected:l===e.id,disabled:!!c&&!c(e),onToggle:o,isToggled:i&&i[e.id],labelData:m[e.id],onFormChange:f,models:g,makePrediction:v})}),r.a.createElement(A.a,{keyName:"esc",onKeyDown:function(){return a(null)}})),r.a.createElement("div",{style:{flex:"0 0 auto",display:"flex"}},r.a.createElement(C.a,{onClick:p},"Back"),r.a.createElement("span",{style:{flex:1}}),r.a.createElement(C.a,{secondary:!0,onClick:d},"Skip"),r.a.createElement(C.a,{primary:!0,onClick:h},"Submit")))}}]),t}(n.PureComponent),de={bbox:"object ungroup outline",polygon:"pencil alternate"},he={bbox:!0,polygon:!0,text:!1,select:!1,"select-one":!1};var me={width:"100%",background:"#fcfcfc",minHeight:40,borderBottom:"1px solid #ccc",padding:"10px 15px"},fe=[{value:.3,text:"Slight"},{value:.6,text:"Normal"},{value:1.2,text:"Strong"},{value:1.6,text:"Extreme"}],ge=[{value:0,text:"1x1"},{value:1,text:"3x3"},{value:2,text:"5x5"}],be={marginLeft:10},ve={marginLeft:20},ye=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.style,a=e.enabled,n=e.smoothing,l=e.precision,i=e.onChange,o={compact:!0,disabled:!a,style:be,onChange:function(e,t){var a=t.name,n=t.value;return i(a,n)}};return r.a.createElement("div",{style:Object(L.a)({},t,me)},r.a.createElement(ce.a,{label:"Auto-tracing",toggle:!0,checked:a,onChange:function(e,t){var a=t.checked;return i("enabled",a)}}),r.a.createElement("span",{style:{marginLeft:100}},r.a.createElement("span",{style:ve},"Smoothing:",r.a.createElement(le.a,Object.assign({},o,{name:"smoothing",value:n,options:fe}))),r.a.createElement("span",{style:ve},"Anchor precision:",r.a.createElement(le.a,Object.assign({},o,{name:"precision",value:l,options:ge})))))}}]),t}(n.PureComponent),Ee=[{value:1,text:"Slight"},{value:2.5,text:"Normal"},{value:5,text:"Strong"},{value:10,text:"Extreme"}],xe={},je=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={model:xe.model||e.models[0].id,smoothing:xe.smoothing||Ee[1].value,loading:!1},a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"handleGenerate",value:function(){var e=Object(x.a)(E.a.mark(function e(t,a){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),e.next=3,this.props.generate(t,{smoothing:a});case 3:this.setState({loading:!1});case 4:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props,a=t.style,n=t.models,l=this.state,i=l.model,c=l.smoothing,s=l.loading,u={style:be,onChange:function(t,a){var n=a.name,r=a.value;e.setState(Object(o.a)({},n,r)),xe[n]=r}},p=n.map(function(e){return{value:e.id,text:e.name}}),d=n.find(function(e){return e.id===i}),h="semantic_segmentation"===d.type?r.a.createElement("span",{style:ve},"Smoothing:",r.a.createElement(le.a,Object.assign({},u,{name:"smoothing",value:c,options:Ee}))):null,m="object_classification"===d.type,f=m?"This model can only be used to generate general tags for text fields.":null;return r.a.createElement("div",{style:Object(L.a)({},a,me)},r.a.createElement("span",{style:ve},"Generate selections using a model",r.a.createElement(le.a,Object.assign({},u,{name:"model",value:i,options:p}))),h,r.a.createElement("span",{style:ve},r.a.createElement(C.a,{disabled:m,onClick:function(){return e.handleGenerate(d,c)}},"Generate"),r.a.createElement(k.a,{active:s,inline:!0}),r.a.createElement("span",null,f)))}}]),t}(n.Component),ke={flex:"0 0 auto",maxHeight:300,padding:"0 10px",textAlign:"center",borderBottom:"1px solid #ccc"},Oe={margin:"0 auto",maxHeight:250};function we(e){var t=e.referenceLink,a=e.referenceText;if(!a&&!t)return null;var n=t?r.a.createElement("img",{alt:"Reference",src:t,style:Oe}):null;return r.a.createElement("div",{style:ke},n,r.a.createElement("p",null,a))}a(465);var Ce=a(301),Se=function(e){function t(e,a){return Object(c.a)(this,t),Object(u.a)(this,Object(p.a)(t).call(this,function(t,a){return-e(t,a)},a))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"maxElementId",value:function(){throw new Error("Cannot call maxElementId on MinHeap")}},{key:"minElementId",value:function(){return Object(Ce.a)(Object(p.a)(t.prototype),"maxElementId",this).call(this)}}]),t}(function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Object(c.a)(this,e),"function"!==typeof t)throw new Error("Passed comparator is invalid, should be a comparison function");this._comparator=t,this._heapIdx=new Map,this._heap=[],Array.isArray(a.initData)&&this._initFromData(a.initData)}return Object(s.a)(e,[{key:"_initFromData",value:function(e){var t=this;if(this._heap=e.map(function(e){return{id:e.id,value:e.value}}),e.forEach(function(e,a){var n=e.id;return t._heapIdx.set(n,a)}),e.length)for(var a=Ae(e.length-1);a>=0;a--)this._downHeap(a)}},{key:"_downHeap",value:function(e){for(;Ie(e)<this.size();){var t=Ie(e),a=Le(e),n=e;if(t<this.size()&&(n=this._maxIndex(n,t)),a<this.size()&&(n=this._maxIndex(n,a)),n===e)break;this._swap(n,e),e=n}}},{key:"_upHeap",value:function(e){for(;e>0;){var t=Ae(e);if(this._maxIndex(t,e)!==e)break;this._swap(t,e),e=t}}},{key:"_maxIndex",value:function(e,t){var a=this._get(e),n=this._get(t);return this._comparator(a,n)>=0?e:t}},{key:"_get",value:function(e){return this._heap[e].value}},{key:"_swap",value:function(e,t){var a=this._heap[e],n=this._heap[t];this._heapIdx.set(a.id,t),this._heapIdx.set(n.id,e),this._heap[e]=n,this._heap[t]=a}},{key:"get",value:function(e){return this.has(e)?this._get(this._heapIdx.get(e)):null}},{key:"set",value:function(e,t){if(this.has(e)){if(this.get(e)===t)return;var a=this._heapIdx.get(e);this._heap[a].value=t,this._upHeap(a),this._downHeap(a)}else this._heapIdx.set(e,this._heap.length),this._heap.push({id:e,value:t}),this._upHeap(this._heap.length-1)}},{key:"remove",value:function(e){if(this.has(e)){var t=this._heap.length-1,a=this._heapIdx.get(e);a!==t?(this._swap(a,t),this._heap.pop(),this._heapIdx.delete(e),this._upHeap(a),this._downHeap(a)):(this._heap.pop(),this._heapIdx.delete(e))}}},{key:"has",value:function(e){return this._heapIdx.has(e)}},{key:"empty",value:function(){return!this.size()}},{key:"clear",value:function(){this._heap=[],this._heapIdx=new Map}},{key:"forEach",value:function(e){this._heap.forEach(function(t){return e(t.value,t.id)})}},{key:"size",value:function(){return this._heap.length}},{key:"setDefault",value:function(e,t){return this.has(e)?this.get(e):(this.set(e,t),t)}},{key:"maxElementId",value:function(){return this.size()?this._heap[0].id:null}},{key:"_selfCheck",value:function(){for(var e=1;e<this._heap.length;e++)if(this._maxIndex(Ae(e),e)!==Ae(e))throw new Error("An item with id ".concat(this._heap[e].id)+" has a parent younger than it: "+this._heap[Ae(e)].id)}}]),e}()),Ie=function(e){return 2*e+1},Le=function(e){return 2*e+2},Ae=function(e){return e-1>>1};var Pe=1;function Te(e){var t=e.points,a=e.height,n=e.width,r=e.imageData,l=e.markRadius;function i(e,t){return 4*n*(a-t)+4*e}function o(e){return{x:e%(4*n)/4,y:a-Math.floor(e/(4*n))}}l=void 0===l?Pe:l;var c,s,u=t.map(function(e){var t=e.x,r=e.y;t=Math.floor(t),r=Math.floor(r);for(var i=[],o=-l;o<=l;o++)for(var c=-l;c<=l;c++){var s={x:t+o,y:r+c};De(s,a,n)&&i.push(s)}return i}).map(function(e){return new Set(e.map(function(e){return i(e.x,e.y)}))});function p(e,t,l){c={x:1/0,y:1/0},s={x:-1/0,y:-1/0};var u=!0,p=!1,d=void 0;try{for(var h,m=l[Symbol.iterator]();!(u=(h=m.next()).done);u=!0){var f=o(h.value);c.x=Math.min(c.x,f.x),c.y=Math.min(c.y,f.y),s.x=Math.max(s.x,f.x),s.y=Math.max(s.y,f.y)}}catch(k){p=!0,d=k}finally{try{u||null==m.return||m.return()}finally{if(p)throw d}}var g=!0,b=!1,v=void 0;try{for(var y,E=e[Symbol.iterator]();!(g=(y=E.next()).done);g=!0){var x=o(y.value);c.x=Math.min(c.x,x.x),c.y=Math.min(c.y,x.y),s.x=Math.max(s.x,x.x),s.y=Math.max(s.y,x.y)}}catch(k){b=!0,v=k}finally{try{g||null==E.return||E.return()}finally{if(b)throw v}}function j(e,t,a,n){for(var l=0,i=0;i<3;i++){var o=(r[e+i]+r[t+i])/2,c=(r[a+i]+r[n+i])/2,s=Math.abs(o-c);l+=s*s}return l}c.x-=3,c.y-=3,s.x+=3,s.y+=3;return function(e,t,a,n){var r=new Se(function(e,t){return e-t}),l=new Map,i=new Map,o=!0,c=!1,s=void 0;try{for(var u,p=e[Symbol.iterator]();!(o=(u=p.next()).done);o=!0){var d=u.value,h=Object(z.a)(d,2),m=h[0],f=h[1];r.set(m,f),i.set(m,f)}}catch(k){c=!0,s=k}finally{try{o||null==p.return||p.return()}finally{if(c)throw s}}for(var g=new Set(t.entries()),b=function(){var e=r.minElementId(),o=r.get(e);r.remove(e),g.has(e)&&g.delete(e),n(e).forEach(function(n){var c=i.has(n)?i.get(n):1/0,s=a(e,n);o+s<=c&&(r.set(n,o+s),i.set(n,o+s),t.has(n)&&g.add(n),l.set(n,e))})};!r.empty()&&g.size>0;)b();return Array.from(t).map(function(e){for(var t=[],a=e;null!==a;)t.push(a),a=l.has(a)?l.get(a):null;return{id:e,path:t.reverse(),distance:i.get(e)}})}(t,l,function(e,t){var a=o(e),n=o(t);if(a.x===n.x)return 1e6-j(i(a.x-1,a.y),i(a.x-1,n.y),i(a.x+1,a.y),i(a.x+1,n.y));if(a.y===n.y)return 1e6-j(i(a.x,a.y-1),i(n.x,n.y-1),i(a.x,a.y+1),i(n.x,n.y+1));var r=i(a.x,n.y),l=i(n.x,a.y),c=j(r,r,l,l);return 1e6-Math.floor(c/1.414)},function(e){for(var t=o(e),r=[],l=-1;l<=1;l++)for(var u=-1;u<=1;u++)(l||u)&&r.push({x:t.x+l,y:t.y+u});return r.filter(function(e){return De(e,a,n)}).filter(function(e){return e.x>=c.x&&e.x<=s.x&&e.y>=c.y&&e.y<=s.y}).map(function(e){return i(e.x,e.y)})})}var d=new Map,h=!0,m=!1,f=void 0;try{for(var g,b=u[0][Symbol.iterator]();!(h=(g=b.next()).done);h=!0){var v=g.value;d.set(v,0)}}catch(k){m=!0,f=k}finally{try{h||null==b.return||b.return()}finally{if(m)throw f}}var y=[];u.forEach(function(e,t){if(t){var a=p(u[t-1],d,e);y.push(a),d=new Map,a.forEach(function(e){var t=e.id,a=e.distance;return d.set(t,a)})}});var E,x=1/0;y[y.length-1].forEach(function(e){var t=e.id,a=e.distance;x>a&&(x=a,E=t)});var j=[];return y.reverse(),y.forEach(function(e){var t=null;e.forEach(function(e){e.id===E&&(t=e)}),t&&(j=t.path.concat(j),E=t.path[0])}),j.map(function(e){return o(e)})}function De(e,t,a){return e.x>=0&&e.x<a&&e.y>=0&&e.y<t}var Re=[[1,0],[0,-1],[-1,0],[0,1]],Fe={DOWN:0,LEFT:1,UP:2,RIGHT:3},Ne=[-1,Fe.DOWN,Fe.RIGHT,Fe.RIGHT,Fe.UP,-1,Fe.UP,Fe.UP,Fe.LEFT,Fe.DOWN,-1,Fe.RIGHT,Fe.LEFT,Fe.DOWN,Fe.LEFT,-1];function He(e,t,a){var n=t.length,r=t[0].length,l=[];l.push(e);for(var i=0,o=0;o<l.length;o++){var c=l[o];i++;for(var s=0;s<Re.length;s++){var u=[c[0]+Re[s][0],c[1]+Re[s][1]];u[0]>=0&&u[0]<n&&u[1]>=0&&u[1]<r&&!t[u[0]][u[1]]&&a[u[0]][u[1]]===a[e[0]][e[1]]&&(t[u[0]][u[1]]=!0,l.push(u))}}if(i<n*r*.002)return null;var p=[e],d=Fe.RIGHT,h=e;function m(t){var l=Object(z.a)(t,2),i=l[0],o=l[1],c=Object(z.a)(e,2),s=c[0],u=c[1],p=0;return o>0&&i>0&&a[i-1][o-1]===a[s][u]&&(p|=1),p<<=1,i>0&&o<r&&a[i-1][o]===a[s][u]&&(p|=1),p<<=1,i<n&&o<r&&a[i][o]===a[s][u]&&(p|=1),p<<=1,i<n&&o>0&&a[i][o-1]===a[s][u]&&(p|=1),p}for(;;){var f=[h[0]+Re[d][0],h[1]+Re[d][1]];if(p.push(f),f[0]===e[0]&&f[1]===e[1])break;var g=m(f),b=Ne[g];-1===b&&(b=(d+1)%4),d=b,h=f}return p}function Me(e,t,a){var n=t.height,r=t.width,l=t.imageData,i=a.smoothing,o=a.precision;(e=e.slice()).push(e[0]);var c=Te({points:e.map(function(e){return{x:e.lng,y:e.lat}}),height:n,width:r,imageData:l,markRadius:o});return D.LineUtil.simplify(c,i||.6).map(function(e){return{lng:e.x,lat:e.y}})}function ze(e,t){var a=t.scaling,n=t.smoothing;return a=a||1,n=n||2,function(e){for(var t=e.length,a=e[0].length,n=e.map(function(e){return e.map(function(){return!1})}),r=[],l=0;l<t;l++)for(var i=0;i<a;i++)n[l][i]||0===e[l][i]||r.push(He([l,i],n,e));return r.filter(function(e){return!!e})}(e=e.map(function(e){return e.map(function(e){return e[0]})})).map(function(t){return D.LineUtil.simplify(t.map(function(t){var a=Object(z.a)(t,2),n=a[0];return{x:a[1],y:e.length-n}}),n).map(function(e){var t=e.x,n=e.y;return{lng:t/a,lat:n/a}})})}var Ue,Be=function(e){function t(e){var a;Object(c.a)(this,t),a=Object(u.a)(this,Object(p.a)(t).call(this,e));var n=e.labels,l={};return n.map(function(e){return l[e.id]=!0}),a.state={selected:null,toggles:l,selectedFigureId:null,reassigning:{status:!1,type:null},hotkeysPanel:!1},a.handleChange=a.handleChange.bind(Object(j.a)(Object(j.a)(a))),a.handleSelected=a.handleSelected.bind(Object(j.a)(Object(j.a)(a))),a.handleSelectionChange=a.handleSelectionChange.bind(Object(j.a)(Object(j.a)(a))),a.canvasRef=r.a.createRef(),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"handleSelected",value:function(e){var t=this;if(e!==this.state.selected){var a=this.props.pushState;if(e){var n=this.props.labels,r=n.findIndex(function(t){return t.id===e}),l=n[r].type,i=Y[r];a(function(e){return{unfinishedFigure:{id:null,color:i,type:l,points:[]}}},function(){return t.setState({selected:e})})}else a(function(e){return{unfinishedFigure:null}},function(){return t.setState({selected:e})})}}},{key:"handleSelectionChange",value:function(e){e?this.setState({selectedFigureId:e}):this.setState({reassigning:{status:!1,type:null},selectedFigureId:null})}},{key:"handleChange",value:function(e,t,a){var n=this;if(t.color){var r=this.props,l=r.labels,i=r.figures,c=r.pushState,s=r.height,u=r.width,p=r.imageData,d="gray"===t.color?{id:"__temp"}:l[Y.indexOf(t.color)],h=(i[d.id]||[]).findIndex(function(e){return e.id===t.id});switch(e){case"new":c(function(e){return{figures:T()(e.figures,Object(o.a)({},d.id,{$push:[{id:t.id||V(),type:t.type,points:t.points}]})),unfinishedFigure:null}},function(){return n.setState({selected:null})});break;case"replace":c(function(e){var a=t.tracingOptions;if(a&&a.enabled){var n={height:s,width:u,imageData:p};a=Object(L.a)({},a,{trace:Me(t.points,n,a)})}else a=Object(L.a)({},a,{trace:[]});return{figures:T()(e.figures,Object(o.a)({},d.id,{$splice:[[h,1,{id:t.id,type:t.type,points:t.points,tracingOptions:a}]]}))}});break;case"delete":c(function(e){return{figures:T()(e.figures,Object(o.a)({},d.id,{$splice:[[h,1]]}))}});break;case"unfinished":c(function(e){return{unfinishedFigure:t}},function(){var e=n.props.unfinishedFigure,t=e.type,a=e.points;"bbox"===t&&a.length>=2&&n.handleChange("new",e)});break;case"recolor":if(d.id===a)return;c(function(e){var n;return{figures:T()(e.figures,(n={},Object(o.a)(n,d.id,{$splice:[[h,1]]}),Object(o.a)(n,a,{$push:[{id:t.id,points:t.points,type:t.type,tracingOptions:t.tracingOptions}]}),n))}});break;default:throw new Error("unknown event type "+e)}}}},{key:"render",value:function(){var e=this,t=this.props,a=t.labels,n=t.imageUrl,l=t.reference,i=t.onBack,c=t.onSkip,s=t.onSubmit,u=t.pushState,p=t.popState,d=t.figures,h=t.unfinishedFigure,m=t.height,f=t.width,g=t.models,b=t.makePrediction,v=this.state,y=v.selected,j=v.selectedFigureId,k=v.reassigning,O=v.toggles,w=v.hotkeysPanel,C={onBack:i,onSkip:c,onSubmit:s,models:g,makePrediction:b},S=null,I=[];a.forEach(function(e,t){d[e.id].forEach(function(a){!O[e.id]||"bbox"!==e.type&&"polygon"!==e.type||(I.push({color:Y[t],points:a.points,id:a.id,type:a.type,tracingOptions:a.tracingOptions}),a.id===j&&(S=Object(L.a)({},a,{color:Y[t]})))})}),d.__temp.forEach(function(e){I.push(Object(L.a)({color:"gray"},e))});var P=k.status?{title:"Select the new label",selected:null,onSelect:function(t){var a=e.canvasRef.current.getSelectedFigure();a&&e.handleChange("recolor",a,t),e.setState({reassigning:{status:!1,type:null}})},filter:function(e){return e.type===k.type},labelData:d}:{title:"Labeling",selected:y,onSelect:this.handleSelected,toggles:O,onToggle:function(t){return e.setState({toggles:T()(O,Object(o.a)({},t.id,{$set:!O[t.id]}))})},openHotkeys:function(){return e.setState({hotkeysPanel:!0})},onFormChange:function(e,t){return u(function(a){return{figures:T()(d,Object(o.a)({},e,{$set:t}))}})},labelData:d},D=w?r.a.createElement(ne,{labels:a.map(function(e){return e.name}),onClose:function(){return e.setState({hotkeysPanel:!1})}}):null,R=null,F={position:"absolute",top:0,left:0,zIndex:1e4};if(S&&"polygon"===S.type){var N=S.tracingOptions||{enabled:!1,smoothing:.3,precision:0,trace:[]};R=r.a.createElement(ye,Object.assign({style:F,onChange:function(t,a){e.handleChange("replace",T()(S,{tracingOptions:{$set:T()(N,Object(o.a)({},t,{$set:a}))}}))}},N))}else!S&&g.length>0&&(R=r.a.createElement(je,{style:F,models:g,generate:function(){var t=Object(x.a)(E.a.mark(function t(a,n){var r;return E.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(a,n);case 2:r=t.sent,"object_classification"!==a.type&&r.forEach(function(t){return e.handleChange("new",t)});case 4:case"end":return t.stop()}},t,this)}));return function(e,a){return t.apply(this,arguments)}}()}));var H=this.props.demo?r.a.createElement("div",{style:{width:"100%",flex:"0 0 auto",background:"#FFD700",padding:"5px 10px",fontWeight:800,textAlign:"center"}},"This is a demo page. The changes will not be saved and all network responses are static."," ",r.a.createElement("a",{target:"_blank",href:"https://github.com/Slava/label-tool"},"GitHub repo")):null;return r.a.createElement("div",{style:{display:"flex",height:"100vh",flexDirection:"column"}},H,r.a.createElement("div",{style:{display:"flex",flex:1,height:"100%"}},r.a.createElement(A.a,{keyName:"ctrl+z",onKeyDown:p},r.a.createElement(pe,Object.assign({labels:a},P,C,{style:{flex:1,maxWidth:300}})),D,r.a.createElement("div",{style:{flex:4,display:"flex",flexDirection:"column"}},r.a.createElement(we,l),r.a.createElement("div",{style:{position:"relative",height:"100%"}},R,r.a.createElement(K,{url:n,height:m,width:f,figures:I,unfinishedFigure:h,onChange:this.handleChange,onReassignment:function(t){return e.setState({reassigning:{status:!0,type:t}})},onSelectionChange:this.handleSelectionChange,ref:this.canvasRef,style:{flex:1}}))))))}}]),t}(n.Component),Ge=function(e){return function(t){function a(e){var t;return Object(c.a)(this,a),(t=Object(u.a)(this,Object(p.a)(a).call(this,e))).state={height:null,width:null,imageData:null},t.componentDidUpdate({},t.state),t}return Object(d.a)(a,t),Object(s.a)(a,[{key:"componentDidUpdate",value:function(e,t){var a=this.props,n=a.imageUrl,r=a.demo;if(n!==e.imageUrl){var l=new Image,i=this.setState.bind(this);l.onload=Object(x.a)(E.a.mark(function e(){var t,a,n;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.height,a=this.width,i({height:t,width:a}),n=function(){var e=document.getElementById("test-canvas"),n=e.getContext("2d"),o=r?.5:Math.min(800,t)/t,c=Math.floor(o*t),s=Math.floor(o*a);e.height=c,e.width=s,n.imageSmoothingQuality="high",n.imageSmoothingEnabled=!0,n.drawImage(l,0,0,s,c);var u=e.toDataURL().substring("data:image/png;base64,".length);e.height=t,e.width=a,n.drawImage(l,0,0,a,t);var p=n.getImageData(0,0,a,t).data;i({imageData:p,imgB64:u,b64Scaling:o})},"loading"!==document.readyState?n():document.addEventListener("DOMContentLoaded",n);case 4:case"end":return e.stop()}},e,this)})),l.src=n}}},{key:"render",value:function(){var t=this.props,a=this.state,n=a.height,l=a.width,i=a.imageData,o=a.imgB64,c=a.b64Scaling;return n?r.a.createElement(e,Object.assign({height:n,width:l,imageData:i,imgB64:o,b64Scaling:c},t)):null}}]),a}(n.Component)}(function(e){return function(t){function a(e){var t;Object(c.a)(this,a),t=Object(u.a)(this,Object(p.a)(a).call(this,e));var n=e.labelData,r=e.labels,l={};return r.map(function(e){return l[e.id]=[]}),l.__temp=[],Object.keys(n).forEach(function(e){l[e]=(l[e]||[]).concat(n[e])}),l=t.flipY(l),t.state={figures:l,unfinishedFigure:null,figuresHistory:[],unfinishedFigureHistory:[]},t.pushState=t.pushState.bind(Object(j.a)(Object(j.a)(t))),t.popState=t.popState.bind(Object(j.a)(Object(j.a)(t))),t}return Object(d.a)(a,t),Object(s.a)(a,[{key:"flipY",value:function(e){var t=this,a={};return Object.keys(e).forEach(function(n){a[n]=e[n].map(function(e){return"polygon"!==e.type&&"bbox"!==e.type?e:(a=e.tracingOptions&&e.tracingOptions.enabled?Object(L.a)({},e.tracingOptions,{trace:t.transformPoints(e.tracingOptions.trace)}):e.tracingOptions,Object(L.a)({},e,{points:t.transformPoints(e.points),tracingOptions:a}));var a})}),a}},{key:"transformPoints",value:function(e){var t=this.props.height;return e.map(function(e){var a=e.lat,n=e.lng;return{lat:t-a,lng:n}})}},{key:"componentDidUpdate",value:function(e,t){var a=this.props,n=a.onLabelChange,r=a.height,l=a.width,i=this.state.figures;i!==t.figures&&n({labels:this.flipY(i),height:r,width:l})}},{key:"pushState",value:function(e,t){this.setState(function(t){return Object(L.a)({figuresHistory:T()(t.figuresHistory,{$push:[t.figures]}),unfinishedFigureHistory:T()(t.unfinishedFigureHistory,{$push:[t.unfinishedFigure]})},e(t))},t)}},{key:"popState",value:function(){this.setState(function(e){var t=e.figuresHistory,a=e.unfinishedFigureHistory;if(!t.length)return{};t=t.slice(),a=a.slice();var n=t.pop(),r=a.pop();return r&&!r.points.length&&(r=null),{figures:n,unfinishedFigure:r,figuresHistory:t,unfinishedFigureHistory:a}})}},{key:"render",value:function(){var t=this.props,a=this.state,n={pushState:this.pushState,popState:this.popState,figures:a.figures,unfinishedFigure:a.unfinishedFigure};return r.a.createElement(e,Object.assign({},n,t))}}]),a}(n.Component)}((Ue=Be,function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={models:[]},a.makePrediction=a.makePrediction.bind(Object(j.a)(Object(j.a)(a))),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"makePrediction",value:function(){var e=Object(x.a)(E.a.mark(function e(t){var a,n,r,l,i,o,c,s,u,p,d,h,m,f,g=arguments;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>1&&void 0!==g[1]?g[1]:{},n=this.props,r=n.imgB64,l=n.b64Scaling,i=n.height,o=n.width,c=n.fetch,s=t.id,u=c("/api/mlmodels/"+s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({instances:[{input_bytes:{b64:r}}]})}),e.next=6,u;case 6:return e.next=8,e.sent.json();case 8:if(p=e.sent,"object_detection"!==t.type){e.next=15;break}return d=[],p.predictions.forEach(function(e){var a=Object(z.a)(e.det_boxes,4),n=a[0],r=a[1],l=a[2],c=a[3];d.push({type:"bbox",color:"gray",points:[{lng:r*o,lat:(1-n)*i},{lng:c*o,lat:(1-l)*i}],id:V(),modelId:t.id})}),e.abrupt("return",d);case 15:if("semantic_segmentation"!==t.type){e.next=20;break}return h=p.predictions[0].raw_image,m=a.smoothing,f=ze(h,{scaling:l,smoothing:m}),e.abrupt("return",f.map(function(e){return{type:"polygon",color:"gray",points:e,id:V(),modelId:t.id}}));case 20:return e.abrupt("return",p.predictions);case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t,a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.fetch,e.next=3,t("/api/mlmodels");case 3:return e.next=5,e.sent.json();case 5:a=e.sent,this.setState({models:a});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.props,t=this.state,a=(e.imgB64,Object(Q.a)(e,["imgB64"])),n={models:t.models,makePrediction:this.makePrediction};return r.a.createElement(Ue,Object.assign({},n,a))}}]),t}(n.Component)))),_e=a(95),Je=a.n(_e),We=a(272),Xe=a.n(We),Ze=a(273),Ve=a.n(Ze),Ye=a(274),Qe=a.n(Ye),qe={"/api/getLabelingInfo":function(e){var t=[{lat:309.045449970124,lng:625.3817609078532},{lat:389.39416927673574,lng:636.0189083788734},{lat:391.74775348325585,lng:630.3874266468058},{lat:418.2995456637876,lng:649.6483578597326},{lat:442.7837802564911,lng:650.5189084230287},{lat:456.5065601296597,lng:656.2611489389324},{lat:457.14786455087716,lng:675.4384182973803},{lat:427.1138701171609,lng:687.190850901878},{lat:416.01435043513527,lng:680.9881781383931},{lat:404.63825712075703,lng:700.754498022768},{lat:348.10066020274917,lng:706.2554371527104},{lat:307.3043488435318,lng:713.6338242619977},{lat:297.63517780645657,lng:707.2677077164033},{lat:301.754589002519,lng:699.4873776084357},{lat:343.34918202031685,lng:694.0881597393285},{lat:263.2327265766655,lng:699.2697399676117},{lat:226.99605937946436,lng:680.4440840363329},{lat:193.5886815129756,lng:683.2733733670453},{lat:194.45923207627172,lng:663.7948045132946},{lat:252.89493863752404,lng:653.5658353945652},{lat:282.2760201487682,lng:653.7834730353892},{lat:278.79381789558374,lng:625.9258550099132}].map(function(e){return{lat:700-e.lat,lng:e.lng}}),a=[{lat:200.46477246638622,lng:770.3928381027434},{lat:202.93964620053913,lng:761.9075567285049},{lat:213.72302461363398,lng:760.4933431661318},{lat:226.62772337028846,lng:764.9127605485477},{lat:275.7716446627535,lng:754.1293821354528},{lat:344.8913325237385,lng:759.432682994352},{lat:371.23106012293744,lng:760.6701198614285},{lat:381.48410845014234,lng:741.5782367693917},{lat:400.3992148468825,lng:743.346003722358},{lat:401.63665171395894,lng:739.2801397305354},{lat:436.28488399209976,lng:750.9474016201134},{lat:450.6037963111274,lng:780.1155563440585},{lat:479.41839764447917,lng:770.5696147980401},{lat:493.9140866588034,lng:778.7013427816854},{lat:493.3837565729135,lng:798.853886045502},{lat:483.3074849410052,lng:808.5766042868171},{lat:469.51890270786754,lng:806.2785072479608},{lat:462.2710582007054,lng:798.853886045502},{lat:450.780573006424,lng:799.5609928266886},{lat:440.5275246792191,lng:828.9059242459302},{lat:423.291796887797,lng:834.386001800126},{lat:406.05606909637487,lng:839.8660793543218},{lat:402.3437584951455,lng:835.0931085813125},{lat:379.716341497176,lng:842.5177297837713},{lat:355.85148763213004,lng:844.2854967367377},{lat:346.39393443375997,lng:847.7326422950221},{lat:343.56550730901375,lng:844.8158268226276},{lat:325.35750769346015,lng:846.6719821232423},{lat:319.9658184869127,lng:841.4570696119915},{lat:324.38523586932865,lng:826.607827207074},{lat:336.59783310277044,lng:834.731484905481},{lat:352.07604580659114,lng:835.3908786715936},{lat:369.1758521514147,lng:829.5128759753552},{lat:386.2756584962383,lng:823.6348732791167},{lat:353.38624554456584,lng:822.2353237918115},{lat:317.69773361828294,lng:825.2676810143062},{lat:253.50359574886406,lng:826.0655287481668},{lat:204.2428073372761,lng:815.8344419242217},{lat:190.22242909705494,lng:826.0655287481668},{lat:186.85493641000312,lng:813.560867074456},{lat:189.08564167217213,lng:801.0562054007453},{lat:194.76957879658613,lng:795.7511974179589},{lat:258.42967459002284,lng:804.087638533766},{lat:316.7847624006732,lng:795.3722682763313},{lat:274.99975551549045,lng:781.1453633343426},{lat:238.34643008376008,lng:783.2465357442481}].map(function(e){return{lat:700-e.lat,lng:e.lng}});return{ok:!0,status:200,json:function(){var e=Object(x.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{project:{id:"demo",name:"Test Project",referenceText:null,referenceLink:null,form:{formParts:[{id:"mzs64divv",name:"Human",type:"polygon"},{id:"ywx7emnqc",name:"Shoes",type:"bbox"},{id:"qvjf23y51",name:"Image quality",type:"select-one",options:["Bad","Okay","Excellent"]}]}},image:{id:1,originalName:"demo.jpg",link:Xe.a,externalLink:null,localPath:null,labeled:0,labelData:{labels:{mzs64divv:[{id:"hpctbyvju7k5t68znsphx3",type:"polygon",points:t,tracingOptions:{trace:[],enabled:!1,smoothing:1.2}},{id:"hpctbyvju7k5t68znsphx4",type:"polygon",points:a,tracingOptions:{trace:[],enabled:!1,smoothing:1.2}}]}},lastEdited:1552629203129,projectsId:"demo"}});case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},"/api/mlmodels":function(){return{ok:1,status:200,json:function(){var e=Object(x.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[{id:1,name:"object detection - faster_rcnn",url:"http://someserver.com/v1/models/faster_rcnn:predict",type:"object_detection"},{id:2,name:"semantic segmentation - deeplabv3",url:"http://someserver.com/v1/models/deeplabv3plus_xception65:predict",type:"semantic_segmentation"}]);case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},"/api/mlmodels/1":function(){return fetch(Qe.a)},"/api/mlmodels/2":function(){return fetch(Ve.a)},"/api/images/1":function(){return{ok:1,status:200}}},Ke=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={project:null,image:null,isLoaded:!1,error:null},a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"fetch",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(Object(x.a)(E.a.mark(function e(){var t,a,n,r,l,i=arguments;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(t=this.props.match.params.projectId,a=i.length,n=new Array(a),r=0;r<a;r++)n[r]=i[r];if("demo"!==t){e.next=5;break}return l="string"===typeof n[0]?n[0]:n[0].pathname,e.abrupt("return",qe[l].apply(qe,n));case 5:return e.next=7,fetch.apply(void 0,n);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})))},{key:"componentDidMount",value:function(){this.refetch()}},{key:"componentDidUpdate",value:function(e){e.match.params.imageId!==this.props.match.params.imageId&&this.refetch()}},{key:"refetch",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t,a,n,r,l,i,o,c,s,u,p;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({isLoaded:!1,error:null,project:null,image:null}),t=this.props,a=t.match,n=t.history,r=a.params,l=r.projectId,i=r.imageId,e.prev=3,(o=document.createElement("a")).setAttribute("href","/api/getLabelingInfo"),(c=new URL(o.href)).searchParams.append("projectId",l),i&&c.searchParams.append("imageId",i),e.next=11,this.fetch(c);case 11:return e.next=13,e.sent.json();case 13:if(s=e.sent,u=s.project,p=s.image,u){e.next=19;break}return n.replace("/label/".concat(l,"/over")),e.abrupt("return");case 19:n.replace("/label/".concat(u.id,"/").concat(p.id)),this.setState({isLoaded:!0,project:u,image:p}),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),this.setState({isLoaded:!0,error:e.t0});case 26:case"end":return e.stop()}},e,this,[[3,23]])}));return function(){return e.apply(this,arguments)}}()},{key:"pushUpdate",value:function(){var e=Object(x.a)(E.a.mark(function e(t){var a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.props.match.params.imageId,e.next=3,this.fetch("/api/images/"+a,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({labelData:t})});case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"markComplete",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.match.params.imageId,e.next=3,this.fetch("/api/images/"+t,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({labeled:!0})});case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props.history,a=this.state,n=a.project,l=a.image,i=a.isLoaded,o=a.error;if(o)return r.a.createElement("div",null,"Error: ",o.message);if(!i)return r.a.createElement(k.a,{active:!0,inline:"centered"});var c="Image ".concat(l.id," for project ").concat(n.name," -- Label Tool"),s={onBack:function(){t.goBack()},onSkip:function(){t.push("/label/".concat(n.id,"/"))},onSubmit:function(){e.markComplete(),t.push("/label/".concat(n.id,"/"))},onLabelChange:this.pushUpdate.bind(this)},u=n.referenceLink,p=n.referenceText;return r.a.createElement(Je.a,{title:c},r.a.createElement(Ge,Object.assign({labels:n.form.formParts,reference:{referenceLink:u,referenceText:p},labelData:l.labelData.labels||{},imageUrl:l.link,fetch:this.fetch.bind(this),demo:"demo"===n.id},s)))}}]),t}(n.Component),$e=a(556),et=(n.Component,a(563)),tt=(a(472),a(549)),at=a(108),nt=a(275),rt=a.n(nt),lt=a(184),it=a(279),ot=a.n(it),ct=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={error:null,isLoaded:!1,images:[]},a.handleLabeled=a.handleLabeled.bind(Object(j.a)(Object(j.a)(a))),a.handleDelete=a.handleDelete.bind(Object(j.a)(Object(j.a)(a))),a.markAllNotLabeled=a.markAllNotLabeled.bind(Object(j.a)(Object(j.a)(a))),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return this.props.projectId!==e.projectId||!ot()(this.state,t)}},{key:"componentDidMount",value:function(){var e=Object(x.a)(E.a.mark(function e(){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.props.refetchRef(this.refetch.bind(this)),e.next=3,this.refetch();case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"refetch",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t,a;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.projectId,e.prev=1,e.next=4,fetch("/api/images/?projectId="+t);case 4:return e.next=6,e.sent.json();case 6:a=e.sent,this.setState({isLoaded:!0,images:a}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),this.setState({isLoaded:!0,error:e.t0});case 13:case"end":return e.stop()}},e,this,[[1,10]])}));return function(){return e.apply(this,arguments)}}()},{key:"handleLabeled",value:function(e,t){var a=this.state.images.findIndex(function(t){return t.id===e});this.setState(function(e){return{images:T()(e.images,{$splice:[[a,1,Object(L.a)({},e.images[a],{labeled:t})]]})}}),fetch("/api/images/"+e,{method:"PATCH",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({labeled:t})})}},{key:"handleDelete",value:function(e){var t=this.state.images.findIndex(function(t){return t.id===e});this.setState(function(e){return{images:T()(e.images,{$splice:[[t,1]]})}}),fetch("/api/images/"+e,{method:"DELETE",headers:{Accept:"application/json","Content-Type":"application/json"}})}},{key:"markAllNotLabeled",value:function(){var e=this;this.state.images.forEach(function(t){return e.handleLabeled(t.id,!1)})}},{key:"render",value:function(){var e=this,t=this.props.projectId,a=this.state,n=a.error,l=a.isLoaded,i=a.images;return n?r.a.createElement("div",null,"Error: ",n.message):l?i.length?r.a.createElement("div",{className:"project-images"},r.a.createElement($.a,{celled:!0,style:{display:"flex",flexDirection:"column",height:600}},r.a.createElement($.a.Header,{style:{flex:"0 0 auto"}},r.a.createElement($.a.Row,{style:{display:"flex",background:"#f9fafb"}},r.a.createElement($.a.HeaderCell,{style:st[0]},"ID"),r.a.createElement($.a.HeaderCell,{style:st[1]},"Image Link"),r.a.createElement($.a.HeaderCell,{style:st[2]},"Label Status"),r.a.createElement($.a.HeaderCell,{style:st[3]},"Actions"),r.a.createElement($.a.HeaderCell,{style:{flex:"0 0 auto",opacity:0,overflowY:"scroll",padding:0,border:0}}))),r.a.createElement($.a.Body,{style:{height:"100%",flex:1,outline:0}},r.a.createElement(pt,{rowHeight:55,rowCount:i.length,style:{overflowY:"scroll"},rowRenderer:function(a){var n=a.index,l=a.style,o=a.key;return r.a.createElement(ut,{key:o,style:l,image:i[n],projectId:t,onLabeled:e.handleLabeled,onDelete:e.handleDelete})},overscanRowCount:10}))),r.a.createElement(C.a,{style:{float:"right"},icon:"cancel",label:"Mark all images as 'Unlabeled'",onClick:this.markAllNotLabeled})):r.a.createElement(S.a,{className:"centered",as:"h5"},"No images, upload images using the form below"):r.a.createElement(k.a,{active:!0,inline:"centered"})}}]),t}(n.Component),st=[{flex:"0 0 80px",lineHeight:"32px"},{flex:"1",lineHeight:"32px"},{flex:"0 0 120px",lineHeight:"32px"},{flex:"0 0 250px",lineHeight:"32px"}],ut=function(e){var t=e.image,a=e.projectId,n=e.style,l=e.onLabeled,i=e.onDelete;return r.a.createElement($.a.Row,{style:Object(L.a)({},n,{display:"flex"})},r.a.createElement($.a.Cell,{style:st[0]},t.id),r.a.createElement($.a.Cell,{style:st[1]},r.a.createElement("a",{href:t.link},t.originalName)),r.a.createElement($.a.Cell,{style:st[2]},r.a.createElement(oe.a,{checked:!!t.labeled,label:"Labeled",onChange:function(e,a){var n=a.checked;return l(t.id,n)}})),r.a.createElement($.a.Cell,{style:st[3]},r.a.createElement("div",null,r.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"/label/".concat(a,"/").concat(t.id)},r.a.createElement(C.a,{icon:"pencil",label:"Edit",size:"tiny"})),r.a.createElement(C.a,{icon:"trash",label:"Delete",size:"tiny",onClick:function(){return i(t.id)}}))))},pt=function(e){return r.a.createElement(lt.a,null,function(t){var a=t.height,n=t.width;return r.a.createElement(lt.b,Object.assign({height:a,width:n},e))})},dt=a(550),ht=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={urlsText:"",localPath:"",urlsError:null,localPathError:null},a.handleChange=a.handleChange.bind(Object(j.a)(Object(j.a)(a))),a.handleSubmit=a.handleSubmit.bind(Object(j.a)(Object(j.a)(a))),a.handlePathSubmit=a.handlePathSubmit.bind(Object(j.a)(Object(j.a)(a))),a.handleFilesSubmit=a.handleFilesSubmit.bind(Object(j.a)(Object(j.a)(a))),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"handleChange",value:function(e,t){var a=t.name,n=t.value;this.setState(Object(o.a)({},a,n))}},{key:"handleSubmit",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t,a,n,r;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state.urlsText,a=this.props.projectId,t){e.next=4;break}return e.abrupt("return");case 4:return n=t.trim().split("\n").filter(function(e){return""!==e}),e.next=7,fetch("/api/images/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:a,urls:n})});case 7:if((r=e.sent).ok){e.next=16;break}return e.t0=this,e.next=12,r.json();case 12:return e.t1=e.sent.message,e.t2={urlsError:e.t1},e.t0.setState.call(e.t0,e.t2),e.abrupt("return");case 16:this.setState({urlsError:null}),this.props.onChange(),this.setState({urlsText:""});case 19:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleFilesSubmit",value:function(){var e=Object(x.a)(E.a.mark(function e(t){var a,n;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=t.target,n=new FormData(a),e.next=5,fetch("/api/uploads/"+this.props.projectId,{method:"POST",body:n});case 5:this.props.onChange(),a.reset();case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"handlePathSubmit",value:function(){var e=Object(x.a)(E.a.mark(function e(t){var a,n,r,l;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),a=t.target,n=this.state.localPath,r=this.props.projectId,n){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,fetch("/api/images/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:r,localPath:n})});case 8:if((l=e.sent).ok){e.next=17;break}return e.t0=this,e.next=13,l.json();case 13:return e.t1=e.sent.message,e.t2={localPathError:e.t1},e.t0.setState.call(e.t0,e.t2),e.abrupt("return");case 17:this.setState({localPathError:null}),this.props.onChange(),a.reset();case 20:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.urlsText,a=e.urlsError,n=e.localPath,l=e.localPathError,i=a?r.a.createElement($e.a,{negative:!0},a):null,o=l?r.a.createElement($e.a,{negative:!0},l):null;return r.a.createElement(ee.a,null,r.a.createElement(O.a,{columns:3,relaxed:"very",stackable:!0},r.a.createElement(O.a.Column,null,r.a.createElement(ie.a,{method:"post",encType:"multipart/form-data",onSubmit:this.handleFilesSubmit},r.a.createElement(ie.a.Input,{label:"Upload files from disk",multiple:!0,type:"file",id:"images",name:"images",accept:".jpg, .jpeg, .png"}),r.a.createElement(C.a,{type:"submit"},"Upload"))),r.a.createElement(O.a.Column,{verticalAlign:"middle"},r.a.createElement(ie.a,{onSubmit:this.handleSubmit},r.a.createElement(ie.a.TextArea,{name:"urlsText",label:"Images URLs",placeholder:"One URL per line i.e. https://images.com/cat.jpg",rows:"3",value:t,onChange:this.handleChange}),r.a.createElement(C.a,null,"Source from URLs")),i),r.a.createElement(O.a.Column,null,r.a.createElement(ie.a,{onSubmit:this.handlePathSubmit},r.a.createElement(ie.a.Input,{name:"localPath",label:"Server's filesystem path",placeholder:"i.e. /mnt/image-server/project-files/",value:n,onChange:this.handleChange}),r.a.createElement(C.a,null,"Source from server's filesystem")),o)),r.a.createElement(dt.a,{vertical:!0,style:{left:"33%"}},"Or"),r.a.createElement(dt.a,{vertical:!0,style:{left:"66%"}},"Or"))}}]),t}(n.Component);var mt={background:"linear-gradient(180deg,#000,#000 20%,#fff 0,#fff 40%,#000 0,#000 60%,#fff 0,#fff 80%,#000 0,#000)",width:25,minWidth:25,height:20,opacity:.25,cursor:"move"},ft=Object(at.sortableHandle)(function(e){var t=e.style;return r.a.createElement("div",{style:Object(L.a)({},mt,t)})}),gt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={message:null,loading:!1},a.handleFilesSubmit=a.handleFilesSubmit.bind(Object(j.a)(Object(j.a)(a))),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"handleFilesSubmit",value:function(){var e=Object(x.a)(E.a.mark(function e(t){var a,n,r,l,i;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=t.target,n=new FormData(a),this.setState({message:null}),e.next=6,fetch("/api/import/"+this.props.projectId,{method:"POST",body:n});case 6:return r=e.sent,e.next=9,r.json();case 9:l=e.sent,i=l.message,this.setState({message:i,loading:!1}),a.reset(),this.props.onChange();case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.message,a=e.loading?r.a.createElement(k.a,null):null,n=(t||"").split("\n").map(function(e){return r.a.createElement("div",null,e)});return r.a.createElement(ee.a,null,r.a.createElement("p",null,"Import image labels exported from tools like"," ",r.a.createElement("a",{href:"https://labelbox.com"},"LabelBox"),"."),r.a.createElement("p",null,'The files must be formatted as a valid JSON, with corresponding image name in the "imagePath" field.'),r.a.createElement("p",null,'Objects from the "shapes" field will be imported as polygons with corresponding labels created.'),r.a.createElement(ie.a,{method:"post",encType:"multipart/form-data",onSubmit:this.handleFilesSubmit},r.a.createElement(ie.a.Input,{label:"Select JSON files",multiple:!0,type:"file",id:"files",name:"files",accept:".json"}),r.a.createElement(C.a,{type:"submit"},"Import")),a,r.a.createElement("div",{style:{marginTop:"2em"}},n))}}]),t}(n.Component),bt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={uploadError:null},a.handleFileSubmit=a.handleFileSubmit.bind(Object(j.a)(Object(j.a)(a))),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"handleFileSubmit",value:function(){var e=Object(x.a)(E.a.mark(function e(t){var a,n,r;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=t.target,n=new FormData(a),e.next=5,fetch("/api/uploads/"+this.props.project.id+"/reference",{method:"POST",body:n});case 5:if((r=e.sent).ok){e.next=14;break}return e.t0=this,e.next=10,r.json();case 10:return e.t1=e.sent.message,e.t2={uploadError:e.t1},e.t0.setState.call(e.t0,e.t2),e.abrupt("return");case 14:this.setState({uploadError:null}),a.reset(),this.props.onUpload();case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.uploadError,t=this.props,a=t.onChange,n=t.project,l=n.referenceText,i=n.referenceLink,o=e?r.a.createElement($e.a,{negative:!0},e):null,c=null;if(l||i){var s=i?r.a.createElement("div",{style:{position:"relative"}},r.a.createElement("img",{alt:"Reference",style:{width:"auto",maxWidth:"100%"},src:i}),r.a.createElement(C.a,{icon:"trash",size:"tiny",label:"Delete",style:{position:"absolute",top:0,right:-125},onClick:function(){return a({referenceText:l,referenceLink:null})}})):null;c=r.a.createElement("div",null,r.a.createElement(S.a,null,"Preview"),r.a.createElement("p",null,"This is what the reference image and text would look like on the top of the labeling page:"),r.a.createElement(ee.a,null,s,l),r.a.createElement(dt.a,null))}return r.a.createElement(ee.a,null,c,r.a.createElement(ie.a,{method:"post",encType:"multipart/form-data",onSubmit:this.handleFileSubmit},r.a.createElement(ie.a.Input,{label:"Upload image from disk",type:"file",id:"referenceImage",name:"referenceImage",accept:".jpg, .jpeg, .png",action:"Upload",style:{maxWidth:600}})),o,r.a.createElement(ie.a,{style:{marginTop:"1em",maxWidth:600}},r.a.createElement(ie.a.TextArea,{autoHeight:!0,label:"Reference Text",placeholder:"Instructions, descriptions, etc",defaultValue:l,onChange:function(e,t){var n=t.value;return a({referenceText:n,referenceLink:i})}})),r.a.createElement(dt.a,null),r.a.createElement("p",null,"The reference information (image and/or text) will be shown on top of the labeling interface to give the labelers more instruction on how to label or something to compare to (image of the key colors, reference images, etc)."))}}]),t}(n.Component),vt=[{value:"object_detection",text:"Object Detection"},{value:"object_classification",text:"Object Classification"},{value:"semantic_segmentation",text:"Semantic Segmentation"}],yt={object_detection:'\n{\n  "predictions": [\n    {\n       "det_boxes": [<ymin>, <xmin>, <ymax>, <xmax>],\n       "det_class": <str>,\n       "det_score": <0 ~ 1 floating number\n    },\n    ...,\n    ...\n    ]\n}\n',object_classification:'\n{\n  "predictions": [[<str>, <str>, <str>, <str>, <str>]]\n}\n',semantic_segmentation:'\n{\n  "predictions": [[...], [...], [...], ...]\n}\n'},Et=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={error:null,isLoaded:!1,models:null,currentValue:vt[0].value,url:null,name:null},a.onSubmit=a.onSubmit.bind(Object(j.a)(Object(j.a)(a))),a.onDelete=a.onDelete.bind(Object(j.a)(Object(j.a)(a))),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){this.reload()}},{key:"reload",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/mlmodels/");case 3:return e.next=5,e.sent.json();case 5:t=e.sent,this.setState({isLoaded:!0,error:null,models:t}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.setState({isLoaded:!0,error:e.t0});case 12:case"end":return e.stop()}},e,this,[[0,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"onSubmit",value:function(){var e=Object(x.a)(E.a.mark(function e(t){var a,n,r,l,i;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),a=t.target,n=this.state.currentValue,r=this.state,l=r.url,i=r.name,e.next=6,fetch("/api/mlmodels/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:{url:l,name:i,type:n}})});case 6:a.reset(),this.reload();case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"onDelete",value:function(){var e=Object(x.a)(E.a.mark(function e(t){return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/api/mlmodels/"+t,{method:"DELETE",headers:{"Content-Type":"application/json"}});case 2:this.reload();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,a=t.error,n=t.isLoaded,l=t.models,i=t.currentValue;if(a)return r.a.createElement("div",null,"Error: ",a.message);if(!n)return r.a.createElement(k.a,{active:!0,inline:"centered"});var o=l.length?null:r.a.createElement("div",{style:{textAlign:"center",padding:"3em"}},"No end-points, add one below");return r.a.createElement(ee.a,null,r.a.createElement(S.a,{as:"h2"},"Available end-points"),r.a.createElement($.a,null,r.a.createElement($.a.Header,null,r.a.createElement($.a.Row,null,r.a.createElement($.a.HeaderCell,null,"Name"),r.a.createElement($.a.HeaderCell,null,"URL"),r.a.createElement($.a.HeaderCell,null,"Type"),r.a.createElement($.a.HeaderCell,null,"Actions"))),r.a.createElement($.a.Body,null,(l||[]).map(function(t){var a=t.id,n=t.name,l=t.url,i=t.type;return r.a.createElement($.a.Row,{key:a},r.a.createElement($.a.Cell,null,n),r.a.createElement($.a.Cell,null,l),r.a.createElement($.a.Cell,null,i),r.a.createElement($.a.Cell,null,r.a.createElement(C.a,{icon:"trash",label:"Delete",size:"tiny",onClick:function(){return e.onDelete(a)}})))}))),o,r.a.createElement("div",{style:{marginTop:"2em"}},r.a.createElement(S.a,{as:"h2"},"Add a new end-point"),r.a.createElement(ie.a,{style:{maxWidth:600}},r.a.createElement(ie.a.Select,{label:"Model type",options:vt,value:i,onChange:function(t,a){var n=a.value;return e.setState({currentValue:n})}})),r.a.createElement(S.a,{as:"h3"},"Expected API format"),r.a.createElement($.a,null,r.a.createElement($.a.Header,null,r.a.createElement($.a.Row,null,r.a.createElement($.a.HeaderCell,null,"Input Format"),r.a.createElement($.a.HeaderCell,null,"Output Format"))),r.a.createElement($.a.Body,null,r.a.createElement($.a.Row,null,r.a.createElement($.a.Cell,null,r.a.createElement("pre",null,'\n{\n  "instances": [\n    {\n      "input_bytes": {\n        "b64": "<str>"\n      }\n    }\n  ]\n}\n')),r.a.createElement($.a.Cell,null,r.a.createElement("pre",null,yt[i]))))),r.a.createElement(ie.a,{style:{maxWidth:600},onSubmit:this.onSubmit},r.a.createElement(ie.a.Input,{label:"Display Name",placeholder:"my_model",onChange:function(t,a){var n=a.value;return e.setState({name:n})}}),r.a.createElement(ie.a.Input,{label:"URL",placeholder:"http://host:port/v1/models/{MODEL_NAME}:predict",onChange:function(t,a){var n=a.value;return e.setState({url:n})}}),r.a.createElement(C.a,{type:"submit"},"Add"))))}}]),t}(n.Component),xt=function(e){function t(e){var a;return Object(c.a)(this,t),(a=Object(u.a)(this,Object(p.a)(t).call(this,e))).state={error:null,isLoaded:!1,project:null},a.onSortEnd=a.onSortEnd.bind(Object(j.a)(Object(j.a)(a))),a.handleChange=a.handleChange.bind(Object(j.a)(Object(j.a)(a))),a.handleNew=a.handleNew.bind(Object(j.a)(Object(j.a)(a))),a.handleDelete=a.handleDelete.bind(Object(j.a)(Object(j.a)(a))),a.handleNameChange=a.handleNameChange.bind(Object(j.a)(Object(j.a)(a))),a.handleReferenceChange=a.handleReferenceChange.bind(Object(j.a)(Object(j.a)(a))),a}return Object(d.a)(t,e),Object(s.a)(t,[{key:"componentDidMount",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t,a,n;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.match,a=t.params.projectId,e.prev=2,e.next=5,fetch("/api/projects/"+a);case 5:return e.next=7,e.sent.json();case 7:n=e.sent,this.setState({isLoaded:!0,project:n}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),this.setState({isLoaded:!0,error:e.t0});case 14:case"end":return e.stop()}},e,this,[[2,11]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e,t){var a=this.state.project;if(a){var n=this.props.match.params.projectId;t.project!==a&&fetch("/api/projects/"+n,{headers:{Accept:"application/json","Content-Type":"application/json"},method:"PATCH",body:JSON.stringify({project:a})})}}},{key:"onSortEnd",value:function(e){var t=e.oldIndex,a=e.newIndex;this.setState(function(e){var n=e.project;return{project:T()(n,{form:{formParts:{$set:rt()(n.form.formParts,t,a)}}})}})}},{key:"handleChange",value:function(e,t){var a=this.state.project,n=t?[1,t]:[1];this.setState({project:T()(a,{form:{formParts:{$splice:[[a.form.formParts.findIndex(function(t){return t.id===e.id})].concat(n)]}}})})}},{key:"handleNew",value:function(){var e=this.state.project;this.setState({project:T()(e,{form:{formParts:{$push:[Ot()]}}})})}},{key:"handleDelete",value:function(){var e=Object(x.a)(E.a.mark(function e(){var t,a,n,r;return E.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,a=t.match,n=t.history,r=a.params.projectId,e.next=4,fetch("/api/projects/"+r,{method:"DELETE"});case 4:n.push("/admin/");case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"handleNameChange",value:function(e){var t=e.target.value,a=this.state.project;this.setState({project:T()(a,{name:{$set:t}})})}},{key:"handleReferenceChange",value:function(e){var t=e.referenceLink,a=e.referenceText,n=this.state.project;this.setState({project:T()(n,{referenceText:{$set:a},referenceLink:{$set:t}})})}},{key:"render",value:function(){var e=this,t=this.props.match.params.projectId,a=this.state,n=a.error,l=a.isLoaded,i=a.project;if(n)return r.a.createElement("div",null,"Error: ",n.message);if(!l)return r.a.createElement(k.a,{active:!0,inline:"centered"});var o=i.form.formParts,c=o.length?o.map(function(t,a){return r.a.createElement(jt,{key:t.id,index:a,value:t,onChange:e.handleChange})}):r.a.createElement(S.a,{className:"centered",as:"h5"},"No labels, add labels using the plus button below");return r.a.createElement(Je.a,{title:"Edit project ".concat(i.name)},r.a.createElement("div",{style:{display:"flex"}},r.a.createElement("div",{className:"ui",style:{paddingBottom:200,flex:1}},r.a.createElement(tt.a,{placeholder:"Project name",control:"input",defaultValue:i.name,style:{fontSize:24,width:"100%",marginTop:10},onChange:this.handleNameChange}),r.a.createElement("div",{style:{display:"flex",flexDirection:"row-reverse",marginTop:5}},r.a.createElement(tt.a,{label:"Labeling link",value:window.location.origin+"/label/"+t,onClick:function(e){return e.target.select()}})),r.a.createElement("div",{id:"labels",style:{padding:"2em 0 110px 0"}},r.a.createElement(S.a,{disabled:!0},"LABELS"),r.a.createElement(kt,{onSortEnd:this.onSortEnd,useDragHandle:!0},c),r.a.createElement(C.a,{circular:!0,icon:"plus",size:"massive",style:{float:"right",marginTop:"2em"},onClick:this.handleNew})),r.a.createElement("div",{id:"images",style:{padding:"2em 0"}},r.a.createElement(S.a,{disabled:!0},"IMAGES"),r.a.createElement(ct,{projectId:t,refetchRef:function(t){return e.setState({handleImagesChange:t})}})),r.a.createElement("div",{id:"upload-images",style:{padding:"2em 0"}},r.a.createElement(S.a,{disabled:!0},"UPLOAD IMAGES"),r.a.createElement(ht,{projectId:t,onChange:this.state.handleImagesChange})),r.a.createElement("div",{id:"import-data",style:{padding:"2em 0"}},r.a.createElement(S.a,{disabled:!0},"IMPORT DATA"),r.a.createElement(gt,{projectId:t,onChange:function(){e.state.handleImagesChange(),e.componentDidMount()}})),r.a.createElement("div",{id:"export-data",style:{padding:"2em 0"}},r.a.createElement(S.a,{disabled:!0},"EXPORT DATA"),r.a.createElement("a",{href:"/api/projects/".concat(t,"/export")},r.a.createElement(C.a,{icon:"download",label:"Download a zip-file with JSON-encoded labels"}))),r.a.createElement("div",{id:"reference-information",style:{padding:"2em 0"}},r.a.createElement(S.a,{disabled:!0},"REFERENCE INFORMATION"),r.a.createElement(bt,{project:i,onChange:this.handleReferenceChange,onUpload:function(){return e.componentDidMount()}})),r.a.createElement("div",{id:"ml-assistance",style:{padding:"2em 0"}},r.a.createElement(S.a,{disabled:!0},"ML ASSISTANCE MODELS"),r.a.createElement(Et,null)),r.a.createElement("div",{id:"delete-project",style:{padding:"2em 0"}},r.a.createElement(S.a,{disabled:!0},"DELETE PROJECT"),r.a.createElement("p",null,"The button bellow will delete all metadata about labels, images and the project."),r.a.createElement(C.a,{negative:!0,onClick:this.handleDelete},"Delete project"))),r.a.createElement(ee.a,{style:{flex:"0 0 auto",width:200,position:"sticky",top:65,alignSelf:"flex-start",marginTop:0,marginLeft:30,boxShadow:"0 0 #FFFFFF"}},r.a.createElement(S.a,{as:"h4"},"On this page:"),r.a.createElement(re.a,null,r.a.createElement(re.a.Item,null,r.a.createElement("a",{href:"#labels"},"Labels")),r.a.createElement(re.a.Item,null,r.a.createElement("a",{href:"#images"},"Images")),r.a.createElement(re.a.Item,null,r.a.createElement("a",{href:"#upload-images"},"Upload Images")),r.a.createElement(re.a.Item,null,r.a.createElement("a",{href:"#import-data"},"Import data")),r.a.createElement(re.a.Item,null,r.a.createElement("a",{href:"#export-data"},"Export data")),r.a.createElement(re.a.Item,null,r.a.createElement("a",{href:"#reference-information"},"Reference Info")),r.a.createElement(re.a.Item,null,r.a.createElement("a",{href:"#ml-assistance"},"ML Assistance")),r.a.createElement(re.a.Item,null,r.a.createElement("a",{href:"#delete-project"},"Delete Project"))))))}}]),t}(n.Component),jt=Object(at.sortableElement)(function(e){var t=e.value,a=e.onChange,n=function(e){var t=e.value,a=e.onChange;if("text"===t.type)return r.a.createElement(tt.a,{label:"Input box prompt",className:"visible",placeholder:"Ex.: 'car brand and model'",onChange:function(e,n){return a(t,Object(L.a)({},t,{prompt:n.value}))}});if("select"===t.type||"select-one"===t.type){var n=t.options||[],l="select"===t.type?oe.a:ce.a,i=n.map(function(e,i){return r.a.createElement("div",{key:i,className:"form-checkbox"},r.a.createElement(l,{checked:!1,tabIndex:"-1"}),r.a.createElement(tt.a,{style:{top:"-3px"},value:e,size:"small",onChange:function(e,r){return a(t,Object(L.a)({},t,{options:T()(n,{$splice:[[i,1,r.value]]})}))}}),r.a.createElement(C.a,{type:"button",icon:"trash",style:{background:"transparent"},onClick:function(){return a(t,Object(L.a)({},t,{options:T()(n,{$splice:[[i,1]]})}))}}))});return r.a.createElement("div",null,r.a.createElement(S.a,{as:"h5"},"Options:"),i,r.a.createElement(C.a,{type:"button",size:"mini",circular:!0,icon:"plus",onClick:function(){return a(t,Object(L.a)({},t,{options:T()(n,{$push:["Option"]})}))}}))}return null}({value:t,onChange:a});return r.a.createElement("div",{style:{marginTop:"0.7em",padding:"1em",border:"solid 1px #efefef",background:"white",shadow:"rgb(204, 204, 204) 0px 1px 2px"}},r.a.createElement(ie.a,{className:"form-card",style:{display:"flex"}},r.a.createElement(ft,{style:{flex:0,marginTop:9}}),r.a.createElement("div",{style:{flex:1,padding:"0 0.5em"}},r.a.createElement(ie.a.Field,{placeholder:"Label name",control:"input",defaultValue:t.name,style:{padding:3,fontSize:24},onChange:function(e){return a(t,Object(L.a)({},t,{name:e.target.value}))}}),r.a.createElement(ie.a.Select,{label:"Label type",options:[{key:"bbox",text:"Draw a bounding box",value:"bbox"},{key:"polygon",text:"Draw a polygon figure",value:"polygon"},{key:"text",text:"Enter a text label",value:"text"},{key:"select",text:"Select all tags that apply",value:"select"},{key:"select-one",text:"Select one tag that applies",value:"select-one"}],defaultValue:t.type,onChange:function(e,n){return a(t,Object(L.a)({},t,{type:n.value}))},style:{maxWidth:400}}),n),r.a.createElement("div",{style:{flex:"0 0 auto"}},r.a.createElement(C.a,{type:"button",style:{background:"transparent",padding:0},onClick:function(){return a(t,null)}},r.a.createElement(b.a,{name:"trash"})))))}),kt=Object(at.sortableContainer)(function(e){var t=e.children;return r.a.createElement("div",null,t)}),Ot=function(){return{id:Math.random().toString(36).substr(2,9),name:"New label",type:"bbox"}},wt=(n.Component,a(281)),Ct=a.n(wt),St=a(282),It=a.n(St),Lt=a(283),At=a.n(Lt),Pt=a(284),Tt=a.n(Pt),Dt=a(285),Rt=a.n(Dt),Ft=a(286),Nt=a.n(Ft),Ht=a(287),Mt=a.n(Ht),zt=a(288),Ut=a.n(zt),Bt=a(289),Gt=a.n(Bt),_t=a(290),Jt=a.n(_t),Wt=a(291),Xt=a.n(Wt),Zt=a(292),Vt=a.n(Zt),Yt=a(293),Qt=a.n(Yt),qt=a(294),Kt=a.n(qt),$t=a(295),ea=a.n($t),ta=a(296),aa=a.n(ta),na=a(297),ra=a.n(na),la=a(298),ia=a.n(la),oa=a(299),ca=a.n(oa);function sa(e){var t=e.src,a=e.caption;return r.a.createElement("figure",{style:{textAlign:"center",margin:"1em 1em"}},r.a.createElement("img",{src:t,alt:a}),r.a.createElement("figcaption",{style:{color:"#999",fontSize:"12px"}},a))}var ua=[{id:"labeling",title:"How To Label",comp:function(){return r.a.createElement("div",null,r.a.createElement(S.a,{as:"h1"},"How To Label"),r.a.createElement("p",null,"The labeling interface presents the user with a canvas to create and edit figures overlayed over the image being labeled and the list of labels on the left."),r.a.createElement(sa,{src:Ct.a,caption:"Labeling Interface"}),r.a.createElement("p",null,"Let's examine the sidebar in detail. Each label has a shortcut and a color associated with it. The shortcut is usually a number in the 1-9 range. If it is a figure label, pressing the shortcut will activate the drawing mode for the label with the given color."),r.a.createElement("p",null,"The icon next to the label name indicates a figure label. The"," ",r.a.createElement(b.a,{name:"pencil"})," pencil icon indicates a polygon label and the overlapping boxes ",r.a.createElement(b.a,{name:"object ungroup"})," indicate a bounding box."),r.a.createElement(sa,{src:It.a,caption:"Sidebar with labels and visibility toggles"}),r.a.createElement("p",null,"The toggleable ",r.a.createElement(b.a,{name:"eye"})," eye icon allows to hide or show all figures belonging to the label in the segmentation area."),r.a.createElement(sa,{src:Nt.a,caption:"Toggle the eye icon to change the visibility of some label's figures"}),r.a.createElement(S.a,{as:"h2"},"Adding a New Figure"),r.a.createElement("p",null,"Start by clicking on a label on the left that is marked either as a polygon label (",r.a.createElement(b.a,{name:"pencil"})," pencil icon) or as a bounding box label (",r.a.createElement(b.a,{name:"object ungroup"})," box icon)."),r.a.createElement("p",null,"After selecting a drawing label, you can start outlining a figure by clicking on the segmentation area."),r.a.createElement(sa,{src:At.a,caption:"Adding a figure for a bounding box label"}),r.a.createElement(sa,{src:Tt.a,caption:"Adding a figure for a polygon label"}),r.a.createElement(S.a,{as:"h2"},"Editing a Figure"),r.a.createElement("p",null,"To edit a figure click on it to select. Now you can move points by dragging them with your mouse."),r.a.createElement("p",null,"To delete a point, click on it once."),r.a.createElement("p",null,"To add a new point, click on the transparent white point on the edge where you want the new point to be added. Sometimes if two points are too close to each other, you would need to zoom in more to see the transparent white point."),r.a.createElement(sa,{src:Rt.a,caption:"Adding a new point to a figure"}),r.a.createElement(S.a,{as:"h2"},"Reassigning a Figure to a Different Label"),r.a.createElement("p",null,"To change the label for a figure, select the figure, then press the"," ",r.a.createElement(se.a,{as:"span"},"c"),' key (shortcut for "change"). Then select the new label on the sidebar on the left. You can only select another label of the same type (so you can only change polygons to other polygon labels, for example).'),r.a.createElement(sa,{src:Mt.a,caption:"Changing the label from green to blue using the 'c' shortcut key"}),r.a.createElement(S.a,{as:"h2"},"Sumitting the Labeled Image"),r.a.createElement("p",null,'After you are done labeling the image, click the "Submit" button on the sidebar to mark the image as "labeled" and load the next labeling task for the project.'),r.a.createElement(sa,{src:Gt.a,caption:"The buttons on the bottom of the sidebar used to get the next labeling task"}),r.a.createElement("p",null,'Click "Skip" to load a new task without marking the current image as labeled, the labeling progress will be preserved and the image will be assigned again later (possibly to someone else).'),r.a.createElement("p",null,"Every image has a timer. When the time expires, the current labeler is assumed to be idle and the image can get assigned to another labeler. Every time the labels are edited, image's timer is renewed."))}},{id:"labeling-advanced",title:"Advanced Labeling",comp:function(){return r.a.createElement("div",null,r.a.createElement(S.a,{as:"h1"},"Advanced Labeling Features"),r.a.createElement("p",null,"As you get a hang of labeling images there are a couple of more advanced features you could use to make labeling faster."),r.a.createElement(S.a,{as:"h2"},"Using Auto-Tracing"),r.a.createElement("p",null,"Sometimes when you need to make a complicated selection following winding paths you could make use of the auto-tracing feature."," "),r.a.createElement("p",null,"Activate auto-tracing for a polygon figure after selecting one. On the toolbar you can configure the algorithm parameters that suit your selection best."),r.a.createElement(sa,{src:Jt.a,caption:"Toolbar with the ML-based assistance options"}),r.a.createElement(sa,{src:Ut.a,caption:"Using the auto-tracing feature we can make a more complex selection with fewer clicks"}),r.a.createElement(S.a,{as:"h2"},"Using ML Models"),r.a.createElement("p",null,"There are 3 types of ML Model-based assistance supported. Object detection and semantic segmentation models can be used to automatically generate the figures unlabeled. The object description models can be used to generate an input for a text field-based label."),r.a.createElement("p",null,"Generally, the figure-generating models can be called from the toolbar that becomes avialabe once one or more ML Models are added in the admin interface."),r.a.createElement("p",null,"After generating figures you might want to delete the unwanted ones (by selecting them and pressing the ",r.a.createElement(se.a,null,"Delete")," button) or edit the generated paths."),r.a.createElement(sa,{src:Vt.a,caption:"Generating bounding boxes using Object Detection type"}),r.a.createElement(sa,{src:Qt.a,caption:"Generating polygons using Semantic Segmentation type"}),r.a.createElement(sa,{src:Xt.a,caption:"Filling in text inputs using Object Description type"}))}},{id:"admin",title:"Managing Projects",comp:function(){return r.a.createElement("div",null,r.a.createElement(S.a,{as:"h1"},"Managing Projects"),r.a.createElement("p",null,"After creating a project on the"," ",r.a.createElement(m.a,{to:"/admin"},"admin panel page")," you can edit project's details, edit the labels, upload new images, export or import the labeling data etc."),r.a.createElement("p",null,"You can add a variety of label types, either for image segmentation (bounding box, polygon) or textual information (text input, multiple choice, single choice). Drag the label handles to reorder. Renaming a label doesn't change its internal representation id."),r.a.createElement(sa,{src:Kt.a,caption:"The project page allows you to edit its name, and edit the labels"}),r.a.createElement(S.a,{as:"h2"},"Images"),r.a.createElement("p",null,"Next, you can manage all your images, see which ones are labeled, open or delete individual ones."),r.a.createElement(sa,{src:ea.a,caption:"Images management part of the project"}),r.a.createElement(S.a,{as:"h2"},"Data Management"),r.a.createElement("p",null,"Following there are the areas where you can: upload images, import labeling data from tools like"," ",r.a.createElement("a",{href:"https://github.com/wkentaro/labelme"},"LabelMe"),", or export your labeling data in the same format."),r.a.createElement("p",null,"When uploading images from disk, they are stored internally on the server's filesystem. If the other methods are used (URLs, local filesystem path) the files are proxied and never stored internally."),r.a.createElement(sa,{src:aa.a,caption:"Upload, import or export your data"}))}},{id:"admin-advanced",title:"Configuring Advanced Features",comp:function(){return r.a.createElement("div",null,r.a.createElement(S.a,{as:"h1"},"Configuring Advanced Features"),r.a.createElement("p",null,"There are a couple of features that are more specific to use-cases and tasks this app was designed for originally."),r.a.createElement(S.a,{as:"h2"},"Reference Information"),r.a.createElement("p",null,"Sometimes the classification task becomes subjective and some instruction text or a reference image is helpful to display to the labelers. For this reason, you can upload a reference image and add a caption text with necessary instructions that will appear on top of the labeling interface."),r.a.createElement(sa,{src:ra.a,caption:"Adding a reference image and text for a project as an admin"}),r.a.createElement(sa,{src:ia.a,caption:"What a reference image looks like when displayed for the labelers"}),r.a.createElement(S.a,{as:"h2"},"Configuring ML-assisted Features"),r.a.createElement("p",null,"On the bottom of a project page, you can add end-points to the"," ",r.a.createElement("a",{href:"https://www.tensorflow.org/tfx/guide/serving"},"TensorFlow Serving-style")," ","services. For all types of services the image is sent a s base64-encoded png image and depending on the type of the service the app expects a response in a different format. The examples of the request/response exchange are displayed according to the selected type."),r.a.createElement(sa,{src:ca.a,caption:"Adding end-points to ML services"}))}},{id:"security",title:"Security",comp:function(){return r.a.createElement("div",null,r.a.createElement(S.a,{as:"h1"},"Security"),r.a.createElement("p",null,"There is ",r.a.createElement("b",null,"no security")," in the current iteration of the app. There are no user-based permissions, all pages are accessible by anyone."),r.a.createElement("p",null,"Since this app was originally designed to be used internally, on a virtual private network (local to your corporation or a research group) this project currently lacks features that would make it a fully-fledged service like"," ",r.a.createElement("a",{href:"https://www.labelbox.com/"},"LabelBox"),"."))}}],pa=(n.Component,function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e={match:{params:{projectId:"demo",imageId:1}},history:Object(o.a)({replace:function(){},push:function(){},goBack:function(){}},"replace",function(){})};return r.a.createElement(Ke,e)}}]),t}(n.Component));i.a.render(r.a.createElement(pa,null),document.getElementById("root"))}},[[312,2,1]]]);
//# sourceMappingURL=main.a7d4486c.chunk.js.map